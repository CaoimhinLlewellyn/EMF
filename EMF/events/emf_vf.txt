
namespace = emf_vf

# emf_vf.0
# Proxy event for sending faction_vf_legalize_cooperation ultimatum
#
# ROOT = faction leader
character_event = {
	id = emf_vf.0
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		in_faction = faction_vf_legalize_cooperation
	}
	
	immediate = {
		# Give the faction diplomatic immunity (when do they lose immunity? when war is declared?)
		diplomatic_immunity = yes
		any_faction_backer = {
			faction = faction_vf_legalize_cooperation
			diplomatic_immunity = yes
		}
	}

	# AI LIEGE OPTIONS
	##################
	
	option = { # AI liege folds to the ultimatum
		name = OK

		trigger = {
			liege = { ai = yes }
		}

		ai_chance = {
			factor = 20
			
			modifier = {
				factor = 0
				not = {
					faction_power = {
						faction = faction_vf_legalize_cooperation
						power = 0.5
					}
				}
			}
			modifier = {
				factor = 1.25
				liege = { trait = craven }
			}
			modifier = {
				factor = 1.25
				liege = { trait = humble }
			}
			modifier = {
				factor = 1.25
				liege = { trait = kind }
			}
			modifier = {
				factor = 1.25
				liege = { trait = charitable }
			}
			modifier = {
				factor = 1.25
				liege = { trait = patient }
			}
			modifier = {
				factor = 1.25
				liege = { trait = content }
			}
			modifier = {
				factor = 1.5
				liege = { trait = just }
			}
			modifier = {
				factor = 1.5
				liege = { trait = liberal }
			}
			modifier = {
				factor = 1.25
				liege = { trait = trusting }
			}
		}

		liege = { character_event = { id = emf_vf.10 } }
	}
	option = { # AI liege denies the ultimatum
		name = OK

		trigger = {
			liege = { ai = yes }
		}

		ai_chance = {
			factor = 80

			modifier = {
				factor = 1.25
				liege = { trait = proud }
			}
			modifier = {
				factor = 1.5
				liege = { trait = arbitrary }
			}
			modifier = {
				factor = 1.25
				liege = { trait = wroth }
			}
			modifier = {
				factor = 1.25
				liege = { trait = conservative }
			}
			modifier = {
				factor = 1.5
				liege = { trait = paranoid }
			}
			modifier = {
				factor = 1.25
				liege = { trait = cruel }
			}
			modifier = {
				factor = 0.5
				faction_power = {
					faction = faction_vf_legalize_cooperation
					power = 1.0
				}
			}
			modifier = {
				factor = 0.667
				faction_power = {
					faction = faction_vf_legalize_cooperation
					power = 1.5
				}
			}
			modifier = {
				factor = 0.5
				faction_power = {
					faction = faction_vf_legalize_cooperation
					power = 2.0
				}
			}
			modifier = {
				factor = 0.5
				faction_power = {
					faction = faction_vf_legalize_cooperation
					power = 3.0
				}
			}	
			modifier = {
				factor = 0.5
				faction_power = {
					faction = faction_vf_legalize_cooperation
					power = 4.0
				}
			}
		}

		liege = { character_event = { id = emf_vf.11 } }
	}
	
	# PLAYER LIEGE VARIANTS
	#######################

	option = {
		name = OK # Liege is player, send ultimatum variant: Let family not be foes.

		trigger = {
			liege = { ai = no }
			liege = {
				or = {
					is_close_relative = root
					is_allied_with = root
					dynasty = root
				}
			}
		}

		ai_chance = {
			factor = 20
		}

		liege = { letter_event = { id = emf_vf.1 } }
	}
	option = {
		name = OK # Liege is player, send ultimatum variant: I think very highly of you, and that's why I know you'll do the right thing.

		trigger = {
			liege = { ai = no }
			opinion = { who = liege value = 30 }
		}
		
		ai_chance = {
			factor = 10
			
			modifier = {
				factor = 1.1
				opinion = { who = liege value = 40 }
			}
			modifier = {
				factor = 1.1
				opinion = { who = liege value = 50 }
			}
			modifier = {
				factor = 1.1
				opinion = { who = liege value = 60 }
			}
			modifier = {
				factor = 1.1
				opinion = { who = liege value = 70 }
			}
			modifier = {
				factor = 1.1
				opinion = { who = liege value = 80 }
			}
			modifier = {
				factor = 1.1
				opinion = { who = liege value = 90 }
			}
			modifier = {
				factor = 1.25
				opinion = { who = liege value = 100 }
			}
		}

		liege = { letter_event = { id = emf_vf.2 } }
	}
	option = {
		name = OK # Liege is player, send ultimatum variant: Neutral: Permit us to cooperate autonomously as is our right, or we will resort to force.

		trigger = {
			liege = { ai = no }
		}

		ai_chance = {
			factor = 10
		}
		
		liege = { letter_event = { id = emf_vf.3 } }
	}
	option = {
		name = OK # Liege is player, send ultimatum variant: Negative: Liege is disliked by faction leader.

		trigger = {
			liege = { ai = no }
			not = { opinion = { who = liege value = 0 } }
		}

		ai_chance = {
			factor = 10
			
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -10 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -20 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -30 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -40 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -50 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -60 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -70 } }
			}
		}
		
		liege = { letter_event = { id = emf_vf.4 } }
	}
	option = {
		name = OK # Liege is player, send ultimatum variant: Negative: Liege is hated by faction leader.
		
		trigger = {
			liege = { ai = no }
			not = { opinion = { who = liege value = -20 } }
		}
		
		ai_chance = {
			factor = 10
			
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -40 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -50 } }
			}
			modifier = {
				factor = 1.1
				not = { opinion = { who = liege value = -60 } }
			}
			modifier = {
				factor = 1.15
				not = { opinion = { who = liege value = -70 } }
			}
			modifier = {
				factor = 1.2
				not = { opinion = { who = liege value = -80 } }
			}
			modifier = {
				factor = 1.3
				not = { opinion = { who = liege value = -90 } }
			}
			modifier = {
				factor = 1.5
				not = { opinion = { who = liege value = -100 } }
			}
		}
		
		liege = { letter_event = { id = emf_vf.5 } }
	}
}


# emf_vf.1
# Ultimatum letter from FROM, the faction leader, sent to ROOT, the liege (ai = no)
# Variant: Positive: Let family not be foes.
letter_event = {
	id   = emf_vf.1
	desc = emf_vf.1.desc
	is_triggered_only = yes
	
	option = {
		name = emf_vf.1.opt.a
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_fold
			hidden_tooltip = {
				character_event = { id = emf_vf.10 }
			}
		}
	}
	
	option = {
		name = emf_vf.1.opt.b
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_deny
			hidden_tooltip = {
				character_event = { id = emf_vf.11 }
			}
		}
	}
}


# emf_vf.2
# Ultimatum letter from FROM, the faction leader, sent to ROOT, the liege (ai = no)
# Variant: Positive: I think very highly of you, and that's why I know you'll do the right thing.
letter_event = {
	id   = emf_vf.2
	desc = emf_vf.2.desc
	is_triggered_only = yes
	
	option = {
		name = emf_vf.2.opt.a
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_fold
			hidden_tooltip = {
				character_event = { id = emf_vf.10 }
			}
		}
	}
	
	option = {
		name = emf_vf.2.opt.b
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_deny
			hidden_tooltip = {
				character_event = { id = emf_vf.11 }
			}
		}
	}
}


# emf_vf.3
# Ultimatum letter from FROM, the faction leader, sent to ROOT, the liege (ai = no)
# Variant: Neutral: Permit us to cooperate autonomously as is our right, or we will resort to force.
letter_event = {
	id   = emf_vf.3
	desc = emf_vf.3.desc
	is_triggered_only = yes
	
	option = {
		name = emf_vf.3.opt.a
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_fold
			hidden_tooltip = {
				character_event = { id = emf_vf.10 }
			}
		}
	}
	
	option = {
		name = emf_vf.3.opt.b
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_deny
			hidden_tooltip = {
				character_event = { id = emf_vf.11 }
			}
		}
	}
}


# emf_vf.4
# Ultimatum letter from FROM, the faction leader, sent to ROOT, the liege (ai = no)
# Variant: Negative: Liege is disliked by faction leader.
letter_event = {
	id   = emf_vf.4
	desc = emf_vf.4.desc
	is_triggered_only = yes
	
	option = {
		name = emf_vf.4.opt.a
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_fold
			hidden_tooltip = {
				character_event = { id = emf_vf.10 }
			}
		}
	}
	
	option = {
		name = emf_vf.4.opt.b
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_deny
			hidden_tooltip = {
				character_event = { id = emf_vf.11 }
			}
		}
	}
}


# emf_vf.5
# Ultimatum letter from FROM, the faction leader, sent to ROOT, the liege (ai = no)
# Variant: Negative: Liege is hated by faction leader.
letter_event = {
	id   = emf_vf.5
	desc = emf_vf.5.desc
	is_triggered_only = yes
	
	option = {
		name = emf_vf.5.opt.a
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_fold
			hidden_tooltip = {
				character_event = { id = emf_vf.10 }
			}
		}
	}
	
	option = {
		name = emf_vf.5.opt.b
		custom_tooltip = {
			text = emf_ctt_vf_faction_vf_legalize_cooperation_ultimatum_deny
			hidden_tooltip = {
				character_event = { id = emf_vf.11 }
			}
		}
	}
}

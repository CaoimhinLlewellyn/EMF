namespace = emf_crier

# Hear ye, hear ye...
# "A lie can run round the world before the truth has got its boots on."

# Should also add chronicle entries for this stuff

## Will eventually cover:
# Deaths:
# Unusual deaths for religion heads
# Deaths of Emperors
# Deaths of players?

### DEATH EVENTS

## Death Listener Mechanic
## 0-49 Reserved
# Death Proxy - from on_death
character_event = {
	id = emf_crier.0
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		or = {
			# Christian Group
			has_landed_title = k_papal_state
			has_landed_title = k_orthodox
			has_landed_title = d_fraticelli
			has_landed_title = d_paulician
			has_landed_title = d_monothelite
			has_landed_title = d_iconoclast
			has_landed_title = d_miaphysite
			has_landed_title = d_monophysite
			has_landed_title = d_nestorian
		}
	}

	immediate = {
		e_hip = {
			owner = {
				character_event = { id = emf_crier.1 days = 1 }
			}
		}
		log = "Event sent to Isis"
	}
	
	option = {
		name = OK
	}
}

# Isis bounce event
character_event = {
	id = emf_crier.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			is_alive = no
			killer = { always = yes } # Right now this only works when there's a killer, might change in future
		}
	}
	
	immediate = {
		log = "Isis got event"
		FROM = {
			if = { # Sacrifice MA changes
				limit = { death_reason = death_sacrificed }
				religion_authority = {
					modifier = religion_head_sacrificed
					years = 50
				}
				log = "Isis took MA from the [This.Religion.GetName]s"
				if = {
					limit = {
						killer = {
							not = { religion = FROM }
						}
					}
					killer = {
						religion_authority = {
							modifier = sacrificed_other_religion_head
							years = 50
						}
						log = "Isis gave MA to the [This.Religion.GetName]s"
					}
				}
			}
		}
	}
	
	option = { # Christian
		trigger = {
			or = {
				k_papal_state = {
					any_previous_holder = { character = FROM }
				}
				k_orthodox = {
					any_previous_holder = { character = FROM }
				}
				d_fraticelli = {
					any_previous_holder = { character = FROM }
				}
				d_paulician = {
					any_previous_holder = { character = FROM }
				}
				d_monothelite = {
					any_previous_holder = { character = FROM }
				}
				d_iconoclast = {
					any_previous_holder = { character = FROM }
				}
				d_miaphysite = {
					any_previous_holder = { character = FROM }
				}
				d_monophysite = {
					any_previous_holder = { character = FROM }
				}
				d_nestorian = {
					any_previous_holder = { character = FROM }
				}
			}
		}
		name = OK
		
		if = { # Leader was sacrificed by other faith
			limit = {
				FROM = {
					death_reason = death_sacrificed
					killer = {
						not = { religion = FROM }
					}
				}
			}
			FROM = {
				killer = {
					narrative_event = { id = emf_crier.50 }
					# narrative_event = { id = emf_crier.50 days = 21 random = 7 } # Delay to avoid interrupting blots, etc, but might make it instant in future
				}
			}
		}
	}
}

# DEATH FLAVOR NOTES:
# If sacrifice mechanics are added to any other religion, they will need flavor here
# Different flavor depending on religion, might not send to parties who wouldn't care, might use distance as a factor, should have special flavor and rewards for the one who sacrificed (accessed through killer = {} scope), will have minor mechanics such as making Catholic folks hate the character who killed the Pope or reducing the authority of the religion whose leader was sacrificed, etc

## Christian Death Flavor
## 50-99 Reserved
# Former Christian religion head was sacrificed by other faith
# ROOT = killer, FROMFROM = Sacrificed leader
narrative_event = {
	id = emf_crier.50
	title = emf_crier.50.title
	# Killer = Norse
	desc = { # Killer
		text = emf_crier.50.desc_norse_killer
		trigger = {
			character = ROOT
			or = {
				religion = norse_pagan
				religion = norse_pagan_reformed
			}
		}
	}
	desc = { # Killer's Faith
		text = emf_crier.50.desc_norse_faith
		trigger = {
			not = { character = ROOT }
			religion = ROOT
			or = {
				religion = norse_pagan
				religion = norse_pagan_reformed
			}
		}
	}
	desc = { # Sacrifice's religion
		text = emf_crier.50.desc_norse_sacrifice
		trigger = {
			religion = FROMFROM
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	desc = { # Other Christians
		text = emf_crier.50.desc_norse_christians
		trigger = {
			religion_group = christian
			not = { religion = FROMFROM }
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	desc = { # Other religions
		text = emf_crier.50.desc_norse_other
		trigger = {
			not = { religion_group = christian }
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	# Killer = Hindu
	# Killer = Zun
	# Killer = Aztec
	picture = GFX_evt_cathedral
	is_triggered_only = yes
	major = yes
	show_ROOT = yes
	show_from_from = yes
	
	major_trigger = {
		is_playable = yes
	}
	
	option = { # Dummy failsafe option, will be removed later
		trigger = { always = no }
		name = OK
		set_character_flag = someone_is_a_dummy
	}
	option = { # The Pope Killer
		trigger = { character = ROOT }
		name = emf_crier.50.a

		piety = 100
		prestige = 100
		tooltip = {
			religion_authority = {
				modifier = sacrificed_other_religion_head
				years = 50
			}
		}
	}
	option = { # The Killer's faith
		trigger = {
			not = { character = ROOT }
			religion = ROOT
		}
		name = emf_crier.50.b
	}
	option = { # The sacrifice's faith responds
		trigger = {
			religion = FROMFROM
			not = { religion = ROOT }
		}
		name = emf_crier.50.c

		if = {
			limit = { controls_religion = yes }
			add_rival = ROOT # Is this even necessary?
		}
		opinion = {
			modifier = opinion_sacrificed_religion_head
			who = ROOT
			months = 600
		}
		tooltip = {
			religion_authority = {
				modifier = religion_head_sacrificed
				years = 50
			}
		}
	}
	option = { # Other Christians
		trigger = {
			religion_group = christian
			not = { religion = FROMFROM }
			not = { religion = ROOT }
		}
		name = emf_crier.50.d
	}
	option = { # Non-Christians
		trigger = {
			not = { religion_group = christian }
			not = { religion = ROOT }
		}
		name = emf_crier.50.e
	}
}

# Former Christian religion head was sacrificed by own faith?
# Former Christian religion head was executed
# Former Christian religion head was murdered
# Former Christian religion head died in battle
# Former Christian religion head died in a duel

## Muslim Death Flavor
## 100-49 Reserved
# d_sunni
# k_shiite
# d_yazidi
# d_ibadi
# d_kharijite
# d_hurufi

## Pagan Death Flavor
## 150-199 Reserved

## Zoroastrian Death Flavor
## 200-249 Reserved
# d_zoroastrian

## Jewish Death Flavor
## 250-299 Reserved
# d_jewish

## 300-399 Reserved for future religion groups

## Emperor Death Flavor
## 400-449 Reserved

## Player Death Flavor
## 450-499 Reserved

### TITLE EVENTS

## Will eventually cover:
# Titles:
# Formation of new empires (if they don't already have announcement)
# Formation of new kingdoms within distance limits (400 or so?) (if they don't already have announcement)
# Destruction of empires
# Loss of holy site control

namespace = emf_crier

# Hear ye, hear ye...
# "A lie can run round the world before the truth has got its boots on."

# Should also add chronicle entries for this stuff

## Will eventually cover:
# Deaths:
# Unusual deaths for religion heads
# Deaths of Emperors
# Deaths of players in MP

### DEATH EVENTS

## Death Listener Mechanic
## 0-49 Reserved
# Death Proxy - from on_death
character_event = {
	id = emf_crier.0
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		or = {
			# real_tier = EMPEROR
			and = {
				controls_religion = yes
				or = {
					religion_group = christian
					# Insert other religion groups here
				}
			}
			and = {
				ai = no
				multiplayer = yes
			}
		}
	}

	immediate = {
		# Player death mechanic
		if = {
			limit = {
				ai = no
				multiplayer = yes
			}
			character_event = { id = emf_crier.550 }
		}
		# Handle MA changes
		if = {
			limit = { controls_religion = yes }
			e_hip = {
				owner = {
					character_event = { id = emf_crier.1 days = 1 }
				}
			}
		}
		# Send Isis bounce events
		# if = { # Emperor version gets priority
			# limit = { real_tier = EMPEROR }
			# if = { # Also controls religion
				# limit = { controls_religion = yes }
				# e_hip = {
					# owner = {
						# character_event = { id = emf_crier.2 days = 1 }
					# }
				# }
				# break = yes
			# }
			# e_hip = {
				# owner = {
					# character_event = { id = emf_crier.3 days = 1 }
				# }
			# }
			# break = yes
		# }
		if = { # Religious heads come next
			limit = { controls_religion = yes }
			e_hip = {
				owner = {
					character_event = { id = emf_crier.4 days = 1 }
				}
			}
			break = yes
		}
	}
	
	option = {
		name = OK
	}
}

# Isis giveth and Isis taketh away
character_event = {
	id = emf_crier.1
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Isis got MA event"
		FROM = { # MA changes
			if = { # RelHead was sacrificed
				limit = { death_reason = death_sacrificed }
				religion_authority = {
					modifier = religion_head_sacrificed
					years = 50
				}
				log = "Isis took MA from [This.Religion.GetName] faith"
				if = { # Killer was different religion
					limit = {
						killer = {
							not = { religion = FROM }
						}
					}
					killer = {
						religion_authority = {
							modifier = sacrificed_other_religion_head
							years = 50
						}
						log = "Isis gave MA to [This.Religion.GetName] faith"
					}
				}
			}
		}
	}
	
	option = {
		name = OK
	}
}

# Isis bounce event for emperors who are religion heads
character_event = {
	id = emf_crier.2
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Isis got emperor/relhead event"
	}
	
	option = {
		name = OK
	}
}

# Isis bounce event for emperors
character_event = {
	id = emf_crier.3
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		log = "Isis got emperor event"
	}
	
	option = {
		name = OK
	}
}

# Isis bounce event for religious heads
character_event = {
	id = emf_crier.4
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			is_alive = no
			killer = { always = yes } # Right now this only works when there's a killer, might change in future
		}
	}
	
	immediate = {
		log = "Isis got relhead event"
	}
	
	option = { # Christian religious leader
		trigger = { religion_group = christian }
		name = OK
		
		FROM = {
			if = { # Leader was sacrificed by other faith
				limit = {
					death_reason = death_sacrificed
					killer = {
						not = { religion = FROM }
					}
				}
				killer = {
					narrative_event = { id = emf_crier.50 } # Delay?
				}
				break = yes
			}
		}
	}
}

# DEATH FLAVOR NOTES:
# If sacrifice mechanics are added to any other religion, they will need flavor here
# Different flavor depending on religion, might not send to parties who wouldn't care, might use distance as a factor, should have special flavor and rewards for the one who sacrificed (accessed through killer = {} scope), will have minor mechanics such as making Catholic folks hate the character who killed the Pope or reducing the authority of the religion whose leader was sacrificed, etc

## Christian Death Flavor
## 50-99 Reserved
# Former Christian religion head was sacrificed by other faith
# ROOT = killer, FROMFROM = Sacrificed leader
narrative_event = {
	id = emf_crier.50
	title = emf_crier.50.title
	# Killer = Norse
	desc = { # Killer
		text = emf_crier.50.desc_norse_killer
		trigger = {
			character = ROOT
			or = {
				religion = norse_pagan
				religion = norse_pagan_reformed
			}
		}
	}
	desc = { # Killer's Faith
		text = emf_crier.50.desc_norse_faith
		trigger = {
			not = { character = ROOT }
			religion = ROOT
			or = {
				religion = norse_pagan
				religion = norse_pagan_reformed
			}
		}
	}
	desc = { # Sacrifice's religion
		text = emf_crier.50.desc_norse_sacrifice
		trigger = {
			religion = FROMFROM
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	desc = { # Other Christians
		text = emf_crier.50.desc_norse_christians
		trigger = {
			religion_group = christian
			not = { religion = FROMFROM }
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	desc = { # Other religions
		text = emf_crier.50.desc_norse_other
		trigger = {
			not = { religion_group = christian }
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	# Killer = Hindu
	# Killer = Zun
	# Killer = Aztec
	picture = GFX_evt_cathedral
	is_triggered_only = yes
	major = yes
	show_ROOT = yes
	show_from_from = yes
	
	major_trigger = {
		is_playable = yes
	}
	
	option = { # Dummy failsafe option, will be removed later
		trigger = { always = no }
		name = OK
		set_character_flag = someone_is_a_dummy
	}
	option = { # The Pope Killer
		trigger = { character = ROOT }
		name = emf_crier.50.a

		piety = 100
		prestige = 100
		tooltip = {
			religion_authority = {
				modifier = sacrificed_other_religion_head
				years = 50
			}
		}
	}
	option = { # The Killer's faith
		trigger = {
			not = { character = ROOT }
			religion = ROOT
		}
		name = emf_crier.50.b
	}
	option = { # The sacrifice's faith responds
		trigger = {
			religion = FROMFROM
			not = { religion = ROOT }
		}
		name = emf_crier.50.c

		if = {
			limit = { controls_religion = yes }
			add_rival = ROOT # Is this even necessary?
		}
		opinion = {
			modifier = opinion_sacrificed_religion_head
			who = ROOT
			months = 600
		}
		tooltip = {
			religion_authority = {
				modifier = religion_head_sacrificed
				years = 50
			}
		}
	}
	option = { # Other Christians
		trigger = {
			religion_group = christian
			not = { religion = FROMFROM }
			not = { religion = ROOT }
		}
		name = emf_crier.50.d
	}
	option = { # Non-Christians
		trigger = {
			not = { religion_group = christian }
			not = { religion = ROOT }
		}
		name = emf_crier.50.e
	}
}

# Former Christian religion head was sacrificed by own faith?
# Former Christian religion head was executed
# Former Christian religion head was murdered
# Former Christian religion head died in battle
# Former Christian religion head died in a duel

# k_papal_state
# k_orthodox
# d_fraticelli
# d_paulician
# d_monothelite
# d_iconoclast
# d_miaphysite
# d_monophysite
# d_nestorian

## Muslim Death Flavor
## 100-149 Reserved
# d_sunni
# k_shiite
# d_yazidi
# d_ibadi
# d_kharijite
# d_hurufi

## Pagan Death Flavor
## 150-199 Reserved

## Zoroastrian Death Flavor
## 200-249 Reserved
# d_zoroastrian

## Jewish Death Flavor
## 250-299 Reserved
# d_jewish

## 300-349 Reserved for potential religion groups
## 350-399 Reserved for potential religion groups
## 400-449 Reserved for potential religion groups
## 450-499 Reserved for potential religion groups

## Emperor Death Flavor
## 500-549 Reserved

## Player Death Flavor
## 550-599 Reserved
# Notification handler
# Eventually might put flavorful chronicle entries into other player's chronicles?
character_event = {
	id = emf_crier.550
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		any_playable_ruler = {
			limit = {
				ai = no
				not = { character = ROOT }
			}
			character_event = { id = emf_crier.551 }
		}
	}
	
	option = {
		name = OK
	}
}

# Notify other players of a fellow player's death
character_event = {
	id = emf_crier.551
	desc = emf_crier.551.desc
	picture = GFX_evt_death
	is_triggered_only = yes
	notification = yes
	
	option = {
		name = OK
	}
}

### TITLE EVENTS

## Will eventually cover:
# Titles:
# Formation of new empires (if they don't already have announcement)
# Formation of new kingdoms within distance limits (400 or so?) (if they don't already have announcement)
# Destruction of empires
# Loss of holy site control

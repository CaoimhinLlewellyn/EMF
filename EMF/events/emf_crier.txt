namespace = emf_crier

# Hear ye, hear ye...
# "A lie can run round the world before the truth has got its boots on."

### DEATH EVENTS

## Death Listener Mechanic
## 0-49 Reserved
# Death Proxy - from on_death
character_event = {
	id = emf_crier.0
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		has_landed_title = k_papal_state
	}

	immediate = {
		e_hip = {
			owner = {
				character_event = { id = emf_crier.1 days = 1 }
			}
		}
		log = "Event sent to Isis"
	}
	
	option = {
		name = OK
	}
}

# Isis bounce event
character_event = {
	id = emf_crier.1
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		FROM = {
			is_alive = no
			killer = { always = yes } # Right now this only works when there's a killer, might change in future
		}
	}
	
	immediate = {
		log = "Isis got event"
		FROM = {
			if = {
				limit = { death_reason = death_sacrificed }
				religion_authority = {
					modifier = religion_head_sacrificed
					years = 50
				}
				log = "Isis took MA from the [This.Religion.GetName]s"
				if = {
					limit = {
						killer = {
							not = { religion = FROM }
						}
					}
					killer = {
						religion_authority = {
							modifier = sacrificed_other_religion_head
							years = 50
						}
						log = "Isis gave MA to the [This.Religion.GetName]s"
					}
				}
			}
		}
	}
	
	option = { # FROM = Former Pope
		trigger = {
			k_papal_state = {
				any_previous_holder = { character = FROM }
			}
		}
		name = OK
		
		if = { # Pope was sacrificed by other faith
			limit = {
				FROM = {
					death_reason = death_sacrificed
					killer = {
						not = { religion = FROM }
					}
				}
			}
			FROM = {
				killer = {
					narrative_event = { id = emf_crier.50 days = 21 random = 7 } # Delay to avoid interrupting blots, etc, but might make it instant in future
				}
			}
			log = "Isis sent Pope sacrificed narrative event"
		}
	}
}

# DEATH FLAVOR NOTES:
# Different flavor depending on religion, might not send to parties who wouldn't care, might use distance as a factor, should have special flavor and rewards for the one who sacrificed (accessed through killer = {} scope), will have minor mechanics such as making Catholic folks hate the character who killed the Pope or reducing the authority of the religion whose leader was sacrificed, etc

## Papal Death Flavor
## 50-99 Reserved
# Former Pope was sacrificed by other faith
# ROOT = killer, FROMFROM = Sacrificed Pope
narrative_event = {
	id = emf_crier.50
	title = emf_crier.50.title
	# Killer = Norse
	desc = { # Killer
		text = emf_crier.50.desc_norse_killer
		trigger = {
			character = ROOT
			or = {
				religion = norse_pagan
				religion = norse_pagan_reformed
			}
		}
	}
	desc = { # Killer's Faith
		text = emf_crier.50.desc_norse_faith
		trigger = {
			not = { character = ROOT }
			religion = ROOT
			or = {
				religion = norse_pagan
				religion = norse_pagan_reformed
			}
		}
	}
	desc = { # Catholic response
		text = emf_crier.50.desc_norse_catholics
		trigger = {
			religion = catholic
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	desc = { # Other Christian response
		text = emf_crier.50.desc_norse_christians
		trigger = {
			religion_group = christian
			not = { religion = catholic }
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	desc = { # Other religion response
		text = emf_crier.50.desc_norse_other
		trigger = {
			not = { religion_group = christian }
			not = { religion = ROOT }
			ROOT = {
				or = {
					religion = norse_pagan
					religion = norse_pagan_reformed
				}
			}
		}
	}
	picture = GFX_evt_cathedral
	is_triggered_only = yes
	major = yes
	show_from_from = yes
	
	major_trigger = {
		is_playable = yes
	}
	
	immediate = {
	}
	
	option = { # Dummy failsafe option, will be removed later
		trigger = { always = no }
		name = OK
		set_character_flag = someone_is_a_dummy
	}
	option = { # The Pope Killer
		trigger = { character = ROOT }
		name = emf_crier.50.a

		piety = 100
		prestige = 100
		tooltip = {
			religion_authority = {
				modifier = sacrificed_other_religion_head
				years = 50
			}
		}
	}
	option = { # The Killer's faith
		trigger = {
			not = { character = ROOT }
			religion = ROOT
		}
		name = emf_crier.50.b
	}
	option = { # Catholics respond
		trigger = {
			religion = catholic
			not = { religion = ROOT }
		}
		name = emf_crier.50.c

		if = {
			limit = { controls_religion = yes }
			add_rival = ROOT # Is this even necessary?
		}
		opinion = {
			modifier = opinion_sacrificed_religion_head
			who = ROOT
			months = 600
		}
		tooltip = {
			religion_authority = {
				modifier = religion_head_sacrificed
				years = 50
			}
		}
	}
	option = { # Other Christians
		trigger = {
			religion_group = christian
			not = { religion = catholic }
			not = { religion = ROOT }
		}
		name = emf_crier.50.d
	}
	option = { # Non-Christians
		trigger = {
			not = { religion_group = christian }
			not = { religion = ROOT }
		}
		name = emf_crier.50.e
	}
}

# Former Pope was sacrificed by Catholics?

namespace = emf_autolander


# emf_autolander.1
# on_new_holder_usurpation listener for applying Recently Acquired
#
character_event = {
	id = emf_autolander.1
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	ai = no
	
	trigger = {
		FROM = { 
			tier = count
		}
	}
	
	immediate = {
		FROM = { 
			location = {
				add_province_modifier = { name = emf_recently_acquired_timer duration = 14 }
			}
		}
	}
	
	option = { name = OK }
}

# Give away our recently acquired provinces
character_event = {
	id = emf_autolander.2
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	ai = no
	
	trigger = {
		NOT = { demesne_efficiency = 1 }
	}
	
	immediate = {
		if = {
			limit = {
				any_demesne_title = {
					tier = count
					location = {
						has_province_modifier = emf_recently_acquired_timer
						NOT = { capital_scope = { duchy = { de_jure_vassal_or_below = PREVPREVPREV } } }
					}
					can_be_given_away = yes
				}
			}
			random_demesne_title = {
				limit = { 
					tier = count
					location = {
						has_province_modifier = emf_recently_acquired_timer
						NOT = { capital_scope = { duchy = { de_jure_vassal_or_below = PREVPREVPREV } } }
					}
					can_be_given_away = yes
				}
				location = {
					remove_province_modifier = emf_recently_acquired_timer
					province_event = { id = emf_autolander.3 }
				}
			}
		}
	}
	
	option = { name = OK }
}

# Actually give it away
province_event = {
	id = emf_autolander.3
	desc = emf_autolander_prompt
	is_triggered_only = yes
	
	option = { 
		name = OK 
		create_character = {
			dynasty = culture
			female = no
			religion = FROM
			culture = FROM
			random_traits = yes
		}
		new_character = {
			set_defacto_liege = FROM
			ROOT = {
				county = { 
					grant_title = PREVPREV
					FROM = { 
						any_demesne_title = { 
							limit = { tier = baron de_jure_liege = PREVPREV }
							grant_title = PREVPREVPREVPREV
						}
					}
				}
			}
		}
		hidden_tooltip = { FROM = { character_event = {id = emf_autolander.2 } } }
	}
	
	option = { 
		name = Nah
		hidden_tooltip = { FROM = { character_event = {id = emf_autolander.2 } } }
	}
}
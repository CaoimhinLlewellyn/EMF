
# Succession wars [scripted]

namespace = emf_succ_war

# emf_succ_war.0 [Ruler]
#
# Invoked on first day of a character's new reign after succession.
character_event = {
	id = emf_succ_war.0
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		primary_title = {
			save_event_target_as = target_title
			
			any_claimant = {
				log = "[This.GetFullName]: considering [This.GetHerHis] claim..."
				character_event = { id = emf_succ_war.1 }
			}
		}
	}
}

# emf_succ_war.1 [Claimant]
#
# Title is event_target:target_title. FROM is holder.
character_event = {
	id = emf_succ_war.1
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		# Are we a valid PWK (Potential Wannabe King)?
		is_adult = yes
		not = { is_child_of = FROM }
		not = { is_friend = FROM }
		is_theocracy = no
		is_republic = no
		or = {
			is_female = no
			not = { any_spouse = { character = FROM } }
		}
		or = {
			is_female = no
			and = {
				not = { religion_group = muslim }
				event_target:target_title = {
					succ_law_title = {
						not = { has_law = agnatic_succession }
					}
				}
			}
		}
		event_target:target_title = {
			not = {
				any_war = {
					attacker = { character = ROOT }
				}
			}
		}
		or = {
			has_strong_claim = event_target:target_title
			event_target:target_title = { is_pretender = yes }
			FROM = { has_regent = yes }
			and = {
				is_female = no
				FROM = { is_female = yes }
			}
			and = {
				is_landed = yes
				is_close_relative = FROM
			}
		}
	}
	
	immediate = {
		log = "PWK: '[Root.GetFullName]' from realm '[Root.Realm.GetFullName]'"
	}
	
	option = {
		name = YES
		ai_chance = {
			factor = 10
			
			modifier = {
				factor = 2
				trait = ambitious
			}
			modifier = {
				factor = 1.5
				trait = envious
			}
			modifier = {
				factor = 1.5
				trait = arbitrary
			}
			modifier = {
				factor = 1.25
				trait = greedy
			}
			modifier = {
				factor = 1.25
				trait = wroth
			}
			modifier = {
				factor = 1.25
				trait = brave
			}
			modifier = {
				factor = 0.75
				trait = craven
			}
			modifier = {
				factor = 0.1
				trait = just
			}
			modifier = {
				factor = 0.1
				trait = content
			}
			modifier = {
				factor = 5
				is_foe = FROM
			}
		
		}
	}
	
	option = {
		name = NO
		ai_chance = {
			factor = 100
		}
	}
}

# emf_succ_war.2 [Ruler]
#
# 
character_event = {
	id = emf_succ_war.2
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		any_opinion_modifier_target = {
			reverse_has_opinion_modifier = { who = ROOT modifier = opinion_emf_succ_war_pwk }
		}
	}
	
	option = {
		random_opinion_modifier_target = {
			limit = {
				reverse_has_opinion_modifier = { who = ROOT modifier = opinion_emf_succ_war_pwk }
			}
			log = "PWK: '[This.GetFullName]' from realm '[This.Realm.GetFullName]'"
			reverse_remove_opinion = { who = ROOT modifier = opinion_emf_succ_war_pwk }
		}
		character_event = { id = emf_succ_war.2 }
	}
}

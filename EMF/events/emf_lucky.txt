namespace = emf_lucky

# Decision menu
character_event = {
	id = emf_lucky.0
	desc = emf_lucky.0.desc
	picture = GFX_evt_bloody_man
	is_triggered_only = yes
	
	option = { # Random rulers
		name = emf_lucky.0.a
		
		# Choose a finite number of rulers based on title level, playable only
		# Kings: 3
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = king
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = king
				independent = yes
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = king
				independent = yes
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		# Dukes: 5
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = duke
				independent = yes
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = duke
				independent = yes
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = duke
				independent = yes
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = duke
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = duke
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		# Counts: 5
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = count
				independent = yes
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = count
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = count
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = count
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
		random_playable_ruler = {
			limit = {
				ai = yes
				tier = count
				not = {
					any_spouse = { ai = no }
					any_child = { ai = no }
					current_heir = { ai = no }
					is_theocracy = yes
					trait = lucky_ruler
				}
			}
			character_event = { id = emf_lucky.1 tooltip = emf_lucky.1.tt }
		}
	}
	option = { # Historical nations
		trigger = { always = no }
		name = emf_lucky.0.b
		
		# Chooses rulers based on title and date
		# Historical winners = lucky
		# It won't use the normal passing mechanic, but instead probably a maintenance event so the benefits stick to the titles
	}
	option = { # Player centric
		trigger = { always = no }
		name = emf_lucky.0.c
		
		# Chooses rulers based on level of interest to player
	}
	option = { # I changed my mind
		name = emf_lucky.0.d
	}
}

# Event to hand out trait and modifier
character_event = {
	id = emf_lucky.1
	desc = AI_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		add_trait = lucky_ruler
		add_character_modifier = {
			name = emf_mod_lucky_ruler
			duration = -1
			hidden = yes
		}
	}
	option = { name = OK }
}

# Triggered on_death
# Eventually this will require a global flag in the trigger
# That's so we can make room for the historical version which will work by maintenance event based on titles
character_event = {
	id = emf_lucky.2
	desc = AI_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	only_playable = yes
	
	trigger = {
		ai = yes
		trait = lucky_ruler
	}
	
	immediate = {
		current_heir = { # Hand off to heir if conditions are met
			if = {
				limit = {
					ai = yes
					not = {
						any_spouse = { ai = no }
					}
				}
				character_event = { id = emf_lucky.1 }
			}
		}
		if = { # If not, give to a random independent ruler of same tier
			limit = {
				not = {
					current_heir = {
						ai = yes
						not = {
							any_spouse = { ai = no }
						}
					}
				}
				any_playable_ruler = {
					ai = yes
					tier = ROOT
					independent = yes
					not = {
						any_spouse = { ai = no }
						any_child = { ai = no }
						current_heir = { ai = no }
						is_theocracy = yes
						trait = lucky_ruler
					}
				}
			}
			random_playable_ruler = {
				limit = {
					ai = yes
					tier = ROOT
					independent = yes
					not = {
						any_spouse = { ai = no }
						any_child = { ai = no }
						current_heir = { ai = no }
						is_theocracy = yes
						trait = lucky_ruler
					}
				}
				character_event = { id = emf_lucky.1 }
			}
		}
	}
	
	option = { name = OK }
}

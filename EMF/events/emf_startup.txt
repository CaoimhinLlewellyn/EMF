
namespace = emf_startup


character_event = {
	id = emf_startup.0
	desc = AI_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		if = {
			limit = {
				not = {
					k_sicily = {
						de_jure_liege = e_byzantium # Only true for vanilla
					}
				}
			}
			set_global_flag = SWMH
			
			# Destroy de jure k_ireland title if SWMH
			k_ireland = { destroy_landed_title = THIS }

		}

		# Prevent early mending of the Catholic Schism
		if = {
			limit = {
				b_hagiasophia = {
					owner = {
						religion = catholic
					}
				}
			}
			k_orthodox = {
				owner = {
					b_hagiasophia = {
						grant_title_no_opinion = PREV
					}
				}
			}
		}
		
		# Vanilla map dynamic de jure changes
		character_event = { id = emf_startup.2 }
		
		# Initialize dynlevy
		character_event = { id = emf_dynlevy.0 }
	}
	
	option = {
		name = OK
		
		narrative_event = { id = emf_startup.1 }
	}
}


narrative_event = {
	id    = emf_startup.1
	desc  = emf_startup.1.desc
	title = emf_startup.1.title

	picture = GFX_evt_rainy_lanterns
	border  = GFX_event_narrative_frame_diplomacy
	
	major = yes
	hide_from = yes
	is_triggered_only = yes
	
	major_trigger = {
		ai = no
	}
	
	option = {
		name = emf_startup.1.opt.a
	}
}


# Vanilla map dynamic de jure changes
character_event = {
	id = emf_startup.2
	desc = AI_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	trigger = {
		not = { has_global_flag = SWMH }
	}
	
	immediate = {
		k_sicily = { de_jure_liege = e_italy }
		k_venice = { de_jure_liege = e_italy }
		k_croatia = { de_jure_liege = e_carpathia }
		
		d_cibyrrhaeot = { de_jure_liege = k_anatolia }
		
		d_trebizond = { de_jure_liege = k_trebizond }
		d_paphlagonia = { de_jure_liege = k_trebizond }
		d_armeniacon = { de_jure_liege = k_trebizond }

		d_nikaea = { de_jure_liege = k_nikaea }
		d_samos = { de_jure_liege = k_nikaea }
		d_cyprus = { de_jure_liege = k_nikaea }
		
		d_thrace = { de_jure_liege = k_thessalonika }
		d_adrianopolis = { de_jure_liege = k_thessalonika }
		d_thessalonika = { de_jure_liege = k_thessalonika }
		d_athens = { de_jure_liege = k_thessalonika }
		d_aegean_islands = { de_jure_liege = k_thessalonika }
		
		d_dyrrachion = { de_jure_liege = k_epirus }
		d_epirus = { de_jure_liege = k_epirus }
		d_achaia = { de_jure_liege = k_epirus }
		d_krete = { de_jure_liege = k_epirus }
		
		k_byzantium = {
			destroy_landed_title = THIS
			de_jure_liege = 0
		}
		activate_title = { title = k_byzantium status = no }
	}
	
	option = { name = OK }
}


# emf_startup.3
#
# Remove age customizer traits within EVENT_PROCESS_OFFSET days of startup
#
# Due to weirdness with the way ruler designer characters are placed into
# the game in place of a historical character, it actually appears to be
# impossible to remove these traits immediately upon startup (either via
# the welcome event or the on_startup on_action).
character_event = {
	id = emf_startup.3
	desc = HIDE_EVENT
	hide_window = yes
	
	ai = no
	
	mean_time_to_happen = {
		days = 1
		
		modifier = {
			factor = 0.01
		}
	}
	
	option = {
		name = OK
		
		# Remove any temp. age customization traits from Ruler Designer
		remove_trait = age_1
		remove_trait = age_2
		remove_trait = age_4
		remove_trait = age_8
		remove_trait = age_16
		remove_trait = age_32
	}
}

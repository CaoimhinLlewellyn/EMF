# Ward/childhood event chains

namespace = emf_kids

# emf_kids.0
#
# Called as on_adulthood on_action to clear any event flags from the emf_kids
# module that are no longer necessary.
character_event = {
	id = emf_kids.0
	desc = HIDE_EVENT
	hide_window = yes
	is_triggered_only = yes
	
	immediate = {
		clr_character_flag = emf_kids_ch1
	}
	
	option = { name = OK }
}


#### MARTIAL-RELATED: SPARRING WITH STICKS (CHAIN 1) ####

# emf_kids.1
# Beginning of 'sparring with sticks' event chain.
# MTTH-based (rather than childhood pulse), martial proclivity.
# Fires at most once per character. Can fire for girls too.
#
# Flags (out): emf_kids_ch1
character_event = {
	id = emf_kids.1
	desc = HIDE_EVENT
	hide_window = yes
	
	prisoner = no
	min_age = 6
	max_age = 16
	
	trigger = {
		martial = 6
		has_guardian = yes
		guardian = {
			or = {
				ai = yes # We don't care about coherency for AI guardians
				war = no
			}
		}
		not = { has_character_flag = emf_kids_ch1 } # Only fire this event chain once
	}
	
	mean_time_to_happen = {
		months = 60 # FIXME: Needs tuning (currently guesstimated at the risk of firing a lot)
		
		modifier = {
			factor = 3
			is_female = yes
			NOT = { has_global_flag = gender_equality }
		}
		modifier = {
			factor = 0.85
			martial = 7
		}
		modifier = {
			factor = 0.85
			martial = 8
		}
	}
	
	option = {
		name = OK
		set_character_flag = emf_kids_ch1
		guardian = { character_event = { id = emf_kids.2 } }
	}
}


# emf_kids.2
# Guardian: Notice that ward has been sparring with playmates with sticks / wooden swords
character_event = {
	id = emf_kids.2
	desc = emf_kids.2.desc
	picture = GFX_evt_child_sword
	
	is_triggered_only = yes
	
	option = {
		name = emf_kids.2.opt.a # Personally oversee some training sessions
		ai_chance = { factor = 10 }
		
		custom_tooltip = {
			text = emf_kids_chain1_ctt_will_personally_train
			
			hidden_tooltip = {
				FROM = { character_event = { id = emf_kids.3 } } # Notify ward & continue chain
			}
		}
	}
	
	option = {
		name = emf_kids.2.opt.b # Arrange for my marshal to train the child
		ai_chance = { factor = 10 }
		
		FROM = { change_martial = 1 }
	}
	
	option = {
		name = emf_kids.2.opt.c # Forbid ward from messing around with sticks / wooden swords
		ai_chance = { factor = 5 }

		prestige = 5
		
		FROM = {
			character_event = { id = emf_kids.4 tooltip = emf_kids.4.tt } # TT: ... is forbidden from foolishly playing with sticks
			
			opinion = { who = ROOT modifier = opinion_mad_at_guardian years = 5 }
			
			if = {
				limit = {
					NOT = {
						trait = deceitful
						trait = craven
					}
				}
				random_list = {
					20 = {
						hidden_tooltip = { remove_trait = honest }
						add_trait = deceitful
					}
					10 = {
						hidden_tooltip = { remove_trait = brave }
						add_trait = craven
					}
					70 = { }
				}
			}
			if = {
				limit = {
					trait = deceitful
					not = { trait = craven }
				}
				random = {
					chance = 10
					hidden_tooltip = { remove_trait = brave }
					add_trait = craven
				}
			}
			if = {
				limit = {
					not = { trait = deceitful }
					trait = craven
				}
				random = {
					chance = 20
					hidden_tooltip = { remove_trait = honest }
					add_trait = deceitful
				}
			}
		}
	}
}

# emf_kids.3
# Ward: Guardian has noticed me play-fighting with my friends and wants to show me a thing or two him/herself
character_event = {
	id = emf_kids.3
	desc = emf_kids.3.desc
	picture = GFX_evt_child_sword
	
	is_triggered_only = yes
	
	option = {
		name = EXCELLENT
		
		# Continue chain
		hidden_tooltip = {
			FROM = {
				random_list = { # Randomly choose between 2 different arcs:
				                # Probably interchangeable, specific variants of:
								# 'Ward struggles with basic forms and technique'
					50 = { character_event = { id = emf_kids.5 } }
					50 = { character_event = { id = emf_kids.6 } }
			}
		}
	}
}


# emf_kids.4
# Ward: Guardian has noticed me play-fighting with my friends and has forbidden me
#       from playing with foolish little fake swords (or, guardian had better never
#       see him playing with sticks like a fool again)

character_event = {
	id = emf_kids.4
	desc = emf_kids.4.desc
	picture = GFX_evt_child_sword
	
	is_triggered_only = yes
	
	option = {
		name = CURSES
		
		tooltip = {
			opinion = { who = FROM modifier = opinion_mad_at_guardian years = 5 }
		}
	}
}



# emf_kids.5
# Guardian: Ward struggles with basic forms and technique (Variant 1)
character_event = {
	id = emf_kids.5
	desc = emf_kids.5.desc
	picture = GFX_evt_child_sword
	
	is_triggered_only = yes
	
	option = {
		name = emf_kids.5.opt.a # No. You have it all wrong. I'm serious. You need to be constantly moving.
		custom_tooltip = {
			text = emf_kids_chain1_ctt_fight_me # Come on and fight me, kid...
			hidden_tooltip = {
				random_list = {
					50 = { character_event = { id = emf_kids.7 } }
					50 = { character_event = { id = emf_kids.8 } }
				}
			}
		}
	}
	
	option = {
		name = emf_kids.5.opt.b # This kid is not even trying.
		custom_tooltip = {
			text = emf_kids_chain1_ctt_chastise # You are as lazy with the swing of your sword as you are with mathematics...
			hidden_tooltip = {
				random_list = {
					50 = { character_event = { id = emf_kids.8 } }
					50 = { character_event = { id = emf_kids.9 } }
				}
			}
		}
	}
	
	option = {
		name = emf_kids.5.opt.c # We've been working off a sweat. He needs to rest.
		custom_tooltip = {
			text = emf_kids_chain1_ctt_patience # Let's get started again when you feel comfortable...
		}
		if = {
			limit = { trait = slothful }
			random = {
				chance = 90
				character_event = { id = emf_kids.10 tooltip = emf_kids.10.tt } # TT: [This.GetTitledFirstName] rests, and...
			}
		}
		if = {
			limit = { not = { trait = slothful } }
			random_list = {
				10 = { hidden_tooltip = { remove_trait = diligent } add_trait = slothful }
				90 = { character_event = { id = emf_kids.10 tooltip = emf_kids.10.tt } } # TT: [This.GetTitledFirstName] rests, and...
			}
		}
	}
}


# emf_kids.6
# Guardian: Ward struggles with basic forms and technique (Variant 2)
#
# NOTE: Currently uses all the same option text/tooltips as emf_kids.5, although this could be changed to suit.
#       Primarily, we just want variation in the event text, since the whole chain passes through here.
character_event = {
	id = emf_kids.6
	desc = emf_kids.6.desc
	picture = GFX_evt_child_sword
	
	is_triggered_only = yes
	
	option = {
		name = emf_kids.5.opt.a # No. You have it all wrong. I'm serious. You need to be constantly moving.
		custom_tooltip = {
			text = emf_kids_chain1_ctt_fight_me # Come on and fight me, kid...
			hidden_tooltip = {
				random_list = {
					50 = { character_event = { id = emf_kids.7 } }
					50 = { character_event = { id = emf_kids.8 } }
				}
			}
		}
	}
	
	option = {
		name = emf_kids.5.opt.b # This kid is not even trying.
		custom_tooltip = {
			text = emf_kids_chain1_ctt_chastise # You are as lazy with the swing of your sword as you are with mathematics. [...]
			hidden_tooltip = {
				random_list = {
					50 = { character_event = { id = emf_kids.8 } }
					50 = { character_event = { id = emf_kids.9 } }
				}
			}
		}
	}
	
	option = {
		name = emf_kids.5.opt.c # We've been working off a sweat. He needs to rest.
		custom_tooltip = {
			text = emf_kids_chain1_ctt_patience # Let's get started again when you feel comfortable...
		}
		if = {
			limit = { trait = slothful }
			random = {
				chance = 90
				character_event = { id = emf_kids.10 tooltip = emf_kids.10.tt } # TT: [This.GetTitledFirstName] rests, and...
			}
		}
		if = {
			limit = { not = { trait = slothful } }
			random_list = {
				10 = { hidden_tooltip = { remove_trait = diligent } add_trait = slothful }
				90 = { character_event = { id = emf_kids.10 tooltip = emf_kids.10.tt } } # TT: [This.GetTitledFirstName] rests, and...
			}
		}
	}
}

